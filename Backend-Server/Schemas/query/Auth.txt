1-
CREATE TABLE IF NOT EXISTS authentication (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(100) UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash TEXT NOT NULL,
    salt TEXT NOT NULL,
    account_status VARCHAR(50) NOT NULL DEFAULT 'active',
    created_date TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMPTZ,
    reset_code VARCHAR(10),
    reset_code_expires TIMESTAMP,
    mfa_pin VARCHAR(10),
    mfa_pin_expires TIMESTAMP
);
CREATE TABLE IF NOT EXISTS role (
    role_id SERIAL PRIMARY KEY,
    role_name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT
);
CREATE TABLE IF NOT EXISTS permissions (
    permissions_id SERIAL PRIMARY KEY,
    permissions_name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT
);
CREATE TABLE IF NOT EXISTS user_roles (
    junction1_id SERIAL PRIMARY KEY, -- As shown in your diagram
    user_id INT NOT NULL,
    role_id INT NOT NULL,
    
    -- Foreign key to link to the user
    CONSTRAINT fk_user
        FOREIGN KEY(user_id) 
        REFERENCES authentication(user_id)
        ON DELETE CASCADE,
    
    -- Foreign key to link to the role
    CONSTRAINT fk_role
        FOREIGN KEY(role_id) 
        REFERENCES role(role_id)
        ON DELETE CASCADE,
    
    -- Ensures a user can't have the same role twice
    UNIQUE (user_id, role_id)
);
CREATE TABLE IF NOT EXISTS role_permissions (
    role_id INT NOT NULL,
    permissions_id INT NOT NULL,
    
    -- Foreign key to link to the role
    CONSTRAINT fk_role
        FOREIGN KEY(role_id) 
        REFERENCES role(role_id)
        ON DELETE CASCADE,
    
    -- Foreign key to link to the permission
    CONSTRAINT fk_permissions
        FOREIGN KEY(permissions_id) 
        REFERENCES permissions(permissions_id)
        ON DELETE CASCADE,
    
    -- A composite primary key ensures a role can't have the same permission twice
    PRIMARY KEY (role_id, permissions_id)
);


2-
CREATE EXTENSION IF NOT EXISTS pgcrypto;

3-
INSERT INTO auth_schema.role (role_id, role_name, description)
VALUES
(1, 'Admin', 'Full administrative access'),
(2, 'Analyst', 'Can view logs and generate reports')


4-
INSERT INTO auth_schema.authentication (user_id, username, email, password_hash, salt, account_status)
VALUES (
    1, 
    'Admin', 
    'test440.t@gmail.com', 
    crypt('Admin123#!', gen_salt('bf', 8)), 
    '',                                
    'active'
)


5-
INSERT INTO auth_schema.permissions (permissions_id, permissions_name, description)
VALUES
(1, 'create_user', 'Can create new users'),
(2, 'view_logs', 'Can view all logs'),
(3, 'view_alerts', 'Can view all alerts'),
(4, 'manage_devices', 'Can add/remove devices'),
(5, 'acknowledge_alert', 'Can acknowledge and update alert status'),
(6,'generate_reports','can generate reports')


6-
INSERT INTO auth_schema.role_permissions (role_id, permissions_id)
VALUES
(1, 1),(1, 2),(1, 3),(1, 4),(1, 5),(2,2),(2,6)


7-
INSERT INTO auth_schema.user_roles (junction1_id, user_id, role_id)
VALUES
(1, 1, 1)